<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adalet SimÃ¼lasyonu AtaÃ¼ni</title>
    
    <!-- KÃ¼tÃ¼phaneler -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script> <!-- Konfeti iÃ§in -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        :root { --primary-navy: #0f172a; --accent-gold: #fbbf24; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #020617; 
            color: #f1f5f9;
            height: 100dvh; 
            width: 100vw;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- NEON & ANÄ°MASYONLAR --- */
        .btn-glow-teacher { box-shadow: 0 0 15px rgba(234, 179, 8, 0.4); border: 2px solid #facc15; animation: pulse-yellow 3s infinite; }
        @keyframes pulse-yellow { 50% { box-shadow: 0 0 25px rgba(234, 179, 8, 0.6); } }

        .btn-glow-judge { box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); border: 2px solid #64748b; animation: pulse-blue 4s infinite; }
        @keyframes pulse-blue { 50% { box-shadow: 0 0 25px rgba(59, 130, 246, 0.5); } }

        .btn-glow-projector { box-shadow: 0 0 10px #06b6d4; border: 2px solid #22d3ee; animation: pulse-cyan 2s infinite alternate; }
        @keyframes pulse-cyan { from { box-shadow: 0 0 5px #06b6d4; } to { box-shadow: 0 0 20px #22d3ee; } }

        .btn-help { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }

        .nav-item.active { color: #fbbf24; border-top: 3px solid #fbbf24; background: rgba(30, 41, 59, 0.9); }
        .nav-item { transition: all 0.2s ease; border-top: 3px solid transparent; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .speaker-change { animation: flashBg 1s ease; }
        @keyframes flashBg { 0% { background-color: #fbbf24; } 100% { background-color: #1e293b; } }
        
        .blur-overlay { filter: blur(10px); pointer-events: none; user-select: none; }
        
        /* Chat Balon Animasyonu */
        .msg-enter { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Neon Metinler */
        .neon-pink { color: #f472b6; text-shadow: 0 0 5px #be185d; }
        .neon-cyan { color: #22d3ee; text-shadow: 0 0 5px #0e7490; }
        .neon-lime { color: #a3e635; text-shadow: 0 0 5px #4d7c0f; }
        .neon-amber { color: #fbbf24; text-shadow: 0 0 5px #b45309; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>

    <audio id="alert-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
    <audio id="quiz-sound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" preload="auto"></audio>

    <!-- 1. GÄ°RÄ°Å EKRANI -->
    <div id="login-screen" class="absolute inset-0 z-50 bg-slate-950 flex flex-col items-center justify-center p-4">
        
        <!-- KÄ±lavuz Butonu -->
        <button onclick="document.getElementById('help-modal').classList.remove('hidden')" class="absolute top-6 right-6 w-12 h-12 rounded-full bg-purple-600/20 border-2 border-purple-500 text-purple-300 flex items-center justify-center shadow-[0_0_15px_rgba(168,85,247,0.5)] btn-help z-50">
            <i class="fa-solid fa-question text-xl font-bold"></i>
        </button>

        <div class="text-center w-full max-w-md mb-6 relative z-10">
            <div class="bg-white p-3 rounded-full mb-4 inline-block shadow-[0_0_30px_rgba(255,255,255,0.2)]">
                <img src="https://upload.wikimedia.org/wikipedia/tr/c/cc/Ataturkuni_logo.png?20200406213338" alt="Logo" class="w-20 h-20 object-contain">
            </div>
            <h2 class="text-[10px] font-bold text-slate-400 tracking-[0.3em] uppercase mb-1">ATATÃœRK ÃœNÄ°VERSÄ°TESÄ°</h2>
            <h3 class="text-xs text-yellow-400 font-bold tracking-widest border-b border-slate-800 pb-2 inline-block px-4 mb-2">SOSYAL BÄ°LGÄ°LER Ã–ÄRETMENLÄ°ÄÄ°</h3>
            <h1 class="text-4xl font-black tracking-widest text-white drop-shadow-lg">ADALET SÄ°M.</h1>
            <p class="text-slate-500 text-[10px] italic mt-2">HazÄ±rlayan: Muhammet Emin AydÄ±n</p>
        </div>

        <div class="w-full max-w-xs space-y-3 mb-4 z-10">
            <input type="text" id="juri-ad" placeholder="Ã–ÄŸrenci AdÄ± SoyadÄ±" class="w-full p-4 bg-slate-900/80 backdrop-blur rounded-xl border border-slate-700 text-white focus:border-yellow-500 outline-none text-center text-sm shadow-inner transition placeholder-slate-600">
        </div>

        <div class="w-full max-w-md flex-1 overflow-y-auto no-scrollbar bg-slate-900/50 p-4 rounded-xl border border-slate-800 mb-24 relative z-10 shadow-inner">
            <p class="text-center text-xs text-slate-400 mb-3 font-bold sticky top-0 bg-slate-900/95 py-2 z-20 border-b border-slate-800">KOLTUK SEÃ‡Ä°MÄ° ğŸ‘‡</p>
            <div id="koltuk-grid" class="grid grid-cols-5 gap-3 pb-4"></div>
        </div>

        <div class="fixed bottom-8 left-0 right-0 flex gap-4 w-full max-w-md mx-auto px-6 z-50 items-center">
            <button onclick="openAdminLogin('teacher')" class="flex-1 text-slate-900 font-black py-4 rounded-2xl transition flex items-center justify-center gap-2 text-xs bg-yellow-500 btn-glow-teacher active:scale-95">
                <i class="fa-solid fa-chalkboard-user text-lg"></i> Ã–ÄRETMEN
            </button>
            <button onclick="openAdminLogin('judge')" class="flex-1 text-white font-bold py-4 rounded-2xl transition flex items-center justify-center gap-2 text-xs bg-slate-700 btn-glow-judge active:scale-95">
                <i class="fa-solid fa-scale-balanced text-lg"></i> HAKÄ°M
            </button>
            <button onclick="openProjectorMode()" class="w-16 h-16 text-white rounded-2xl flex items-center justify-center bg-cyan-600 btn-glow-projector active:scale-95">
                <i class="fa-solid fa-tv text-2xl"></i>
            </button>
        </div>
    </div>

    <!-- 2. Ã–ÄRENCÄ° ARAYÃœZÃœ -->
    <div id="app-interface" class="hidden absolute inset-0 z-10 flex flex-col bg-slate-100">
        <header class="bg-slate-900 text-white p-3 flex justify-between items-center shadow-lg h-16 flex-shrink-0 relative z-30">
            <div><span class="text-[9px] text-slate-400 uppercase tracking-wider block">Dosya No: 2025/456</span><span id="header-user-name" class="font-bold text-yellow-400 text-xs">JÃ¼ri Ãœyesi</span></div>
            <div class="flex items-center gap-3"><div class="bg-slate-800 px-3 py-1 rounded-full border border-yellow-500/30 flex items-center gap-1"><i class="fa-solid fa-star text-yellow-500 text-xs"></i><span id="my-score" class="text-xs font-bold text-white">0</span></div><button onclick="logoutUser()" class="text-slate-400 hover:text-red-400 p-2"><i class="fa-solid fa-right-from-bracket"></i></button></div>
        </header>

        <button onclick="requestSpeech()" class="fixed bottom-24 left-4 z-40 bg-yellow-500 text-slate-900 p-4 rounded-full shadow-xl w-16 h-16 flex flex-col items-center justify-center border-4 border-white/20 active:scale-90 transition"><i class="fa-solid fa-hand text-xl"></i><span class="text-[9px] font-bold mt-1">SÃ–Z</span></button>

        <main class="flex-1 overflow-y-auto no-scrollbar relative w-full pb-20 bg-slate-200 text-slate-800">
            
            <div id="tab-live" class="tab-content active p-4 space-y-4">
                <div class="bg-white p-6 rounded-2xl shadow-lg border-l-4 border-blue-600">
                    <h3 class="font-bold text-slate-800 mb-4 text-center text-sm">VÄ°CDANÄ° KANAAT</h3>
                    <input type="range" id="sentiment-slider" min="0" max="100" value="50" step="10" class="w-full h-4 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                    <div class="flex justify-between text-[10px] font-bold mt-2 px-1"><span class="text-red-600">DAVACI</span><span class="text-green-600">SANIK</span></div>
                    <p id="sentiment-status" class="text-center text-[10px] text-slate-400 mt-2 h-4"></p>
                </div>
            </div>
            
            <div id="tab-evidence" class="tab-content hidden p-4 space-y-4">
                <div class="flex items-center justify-between border-b border-slate-300 pb-2"><span class="text-xs font-black text-slate-600 uppercase">DELÄ°L KLASÃ–RÃœ</span><i class="fa-solid fa-folder-open text-yellow-500"></i></div>
                <!-- Video -->
                <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                    <div class="bg-slate-800 px-3 py-2 text-white text-xs font-bold flex justify-between"><span class="flex items-center gap-2"><i class="fa-solid fa-video text-red-400"></i> Olay Yeri</span><button onclick="projectEvidence('video')" class="text-[9px] bg-cyan-600 px-2 rounded hover:bg-cyan-500">TAHTAYA YANSIT</button></div>
                    <video controls playsinline class="w-full h-48 bg-black object-contain"><source src="olay_yeri.mp4" type="video/mp4"></video>
                </div>
                <!-- Resim 1 -->
                <div class="bg-white p-3 rounded-xl shadow-sm border flex items-center justify-between">
                    <div class="flex items-center gap-3 cursor-pointer" onclick="openImage('WP1.png')"><i class="fa-brands fa-whatsapp text-2xl text-green-600"></i><div><h4 class="text-xs font-bold">Mesaj KaydÄ± 1</h4><p class="text-[10px] text-slate-500">BaÅŸlangÄ±Ã§</p></div></div>
                    <button onclick="projectEvidence('WP1.png')" class="text-xs text-cyan-600 font-bold border border-cyan-600 px-2 py-1 rounded hover:bg-cyan-50">YANSIT</button>
                </div>
                <!-- Resim 2 -->
                <div class="bg-white p-3 rounded-xl shadow-sm border flex items-center justify-between">
                    <div class="flex items-center gap-3 cursor-pointer" onclick="openImage('WP2.png')"><i class="fa-solid fa-triangle-exclamation text-2xl text-red-600"></i><div><h4 class="text-xs font-bold">Mesaj KaydÄ± 2</h4><p class="text-[10px] text-slate-500">Tehdit</p></div></div>
                    <button onclick="projectEvidence('WP2.png')" class="text-xs text-cyan-600 font-bold border border-cyan-600 px-2 py-1 rounded hover:bg-cyan-50">YANSIT</button>
                </div>
                <div class="text-center mt-4"><button onclick="projectEvidence(null)" class="text-xs text-red-500 font-bold underline">YansÄ±tmayÄ± Durdur</button></div>
            </div>

            <div id="tab-chat" class="tab-content hidden flex-col h-full"><div id="mobile-chat-feed" class="flex-1 p-4 space-y-3 overflow-y-auto pb-20"></div><div class="bg-white p-3 border-t flex gap-2 items-center safe-area-bottom sticky bottom-0"><input type="text" id="chat-input" class="flex-1 bg-slate-100 rounded-full px-4 py-3 text-sm outline-none border focus:border-blue-500" placeholder="Yaz..."><button onclick="sendChat()" class="bg-blue-600 text-white w-10 h-10 rounded-full shadow"><i class="fa-solid fa-paper-plane"></i></button></div></div>
            <div id="tab-comm" class="tab-content hidden p-4"><div class="bg-indigo-50 p-5 rounded-xl border border-indigo-100 shadow-sm"><h3 class="font-bold text-indigo-900 text-sm mb-3">Hakime Soru</h3><textarea id="question-input" rows="4" class="w-full p-3 rounded-lg text-sm border border-indigo-200 focus:outline-none" placeholder="..."></textarea><button onclick="sendQuestion()" class="w-full mt-3 bg-indigo-600 text-white py-3 rounded-lg text-sm font-bold shadow">GÃ–NDER</button></div></div>
            <div id="tab-vote" class="tab-content hidden p-6 flex-col justify-center space-y-6 h-full"><h2 class="text-center font-black text-2xl text-slate-800">KARAR VAKTÄ°</h2><button onclick="submitVote('SUÃ‡LU')" class="w-full py-4 bg-red-600 text-white rounded-xl shadow-lg font-bold text-lg active:scale-95">SUÃ‡LU</button><button onclick="submitVote('SUÃ‡SUZ')" class="w-full py-4 bg-green-600 text-white rounded-xl shadow-lg font-bold text-lg active:scale-95">SUÃ‡SUZ</button><p id="vote-status" class="text-center font-bold text-blue-600 text-sm mt-2"></p></div>
        </main>

        <nav class="bg-slate-900 border-t border-slate-800 flex justify-around pb-6 pt-3 h-20 shadow-[0_-5px_15px_rgba(0,0,0,0.3)] z-50 fixed bottom-0 left-0 right-0 w-full text-[10px] text-slate-400">
            <button onclick="switchTab('tab-live', this)" class="nav-item active flex flex-col items-center w-1/5 gap-1"><i class="fa-solid fa-tower-broadcast text-lg"></i>CanlÄ±</button>
            <button onclick="switchTab('tab-evidence', this)" class="nav-item flex flex-col items-center w-1/5 gap-1"><i class="fa-solid fa-folder-open text-lg"></i>KanÄ±t</button>
            <button onclick="switchTab('tab-chat', this)" class="nav-item flex flex-col items-center w-1/5 gap-1"><i class="fa-solid fa-comments text-lg"></i>Sohbet</button>
            <button onclick="switchTab('tab-comm', this)" class="nav-item flex flex-col items-center w-1/5 gap-1"><i class="fa-solid fa-question text-lg"></i>Soru</button>
            <button onclick="switchTab('tab-vote', this)" class="nav-item flex flex-col items-center w-1/5 gap-1"><i class="fa-solid fa-check-to-slot text-lg"></i>Karar</button>
        </nav>
    </div>

    <!-- QUIZ MODAL -->
    <div id="student-quiz-modal" class="hidden fixed inset-0 z-[200] bg-slate-900/95 flex flex-col items-center justify-center p-6 quiz-enter text-white"><div class="w-full max-w-md bg-slate-800 p-6 rounded-2xl border border-slate-600"><div class="flex justify-between items-center mb-6"><span class="bg-red-600 px-3 py-1 rounded text-xs font-bold animate-pulse">CANLI SORU</span><span class="text-yellow-400 font-bold">Cevapla!</span></div><h2 id="quiz-question-text" class="text-xl font-bold text-center mb-6 leading-tight">...</h2><div id="quiz-options-container" class="grid grid-cols-1 gap-3 w-full"></div><p id="quiz-status-text" class="text-center mt-6 text-slate-400 text-sm hidden">CevabÄ±nÄ±z alÄ±ndÄ±.</p></div></div>

    <!-- 3. YÃ–NETÄ°CÄ° PANELÄ° -->
    <div id="admin-panel" class="hidden absolute inset-0 bg-slate-900 text-white z-[150] flex flex-col">
        <header class="flex justify-between items-center p-4 border-b border-slate-700 bg-slate-800"><h1 class="text-lg font-bold text-yellow-400" id="admin-title">YÃ–NETÄ°M</h1><button onclick="location.reload()" class="bg-red-900/50 px-3 py-1 rounded text-xs border border-red-800">Ã‡Ä±kÄ±ÅŸ</button></header>
        <div class="flex border-b border-slate-700 bg-slate-800 text-xs font-bold"><button onclick="switchAdminTab('panel-teacher')" class="flex-1 py-3 text-slate-400 border-b-2 border-transparent focus:text-yellow-400 focus:border-yellow-400 hidden" id="btn-tab-teacher">SINIF</button><button onclick="switchAdminTab('panel-judge')" class="flex-1 py-3 text-slate-400 border-b-2 border-transparent focus:text-yellow-400 focus:border-yellow-400" id="btn-tab-judge">DURUÅMA</button></div>
        <div class="flex-1 overflow-y-auto p-4 space-y-6">
            <div id="panel-teacher" class="hidden space-y-6">
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><h3 class="text-sm font-bold text-green-400 mb-3">Quiz BaÅŸlat</h3><input type="text" id="quiz-q" placeholder="Soru" class="w-full p-2 bg-slate-900 rounded border border-slate-600 mb-2 text-xs"><div class="grid grid-cols-2 gap-2 mb-2"><input type="text" id="quiz-opt1" placeholder="A" class="p-2 bg-slate-900 text-xs"><input type="text" id="quiz-opt2" placeholder="B" class="p-2 bg-slate-900 text-xs"><input type="text" id="quiz-opt3" placeholder="C" class="p-2 bg-slate-900 text-xs"><input type="text" id="quiz-opt4" placeholder="D" class="p-2 bg-slate-900 text-xs"></div><select id="quiz-correct" class="w-full p-2 bg-slate-900 text-xs mb-2 text-slate-400"><option value="">DoÄŸru Cevap</option><option value="0">A</option><option value="1">B</option><option value="2">C</option><option value="3">D</option></select><div class="flex gap-2"><button onclick="publishQuiz()" class="flex-1 bg-green-600 py-2 rounded text-xs font-bold">YAYINLA</button><button onclick="closeQuiz()" class="bg-red-600 px-4 py-2 rounded text-xs font-bold">BÄ°TÄ°R</button></div></div>
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><h3 class="text-sm font-bold text-slate-400 uppercase mb-2">CanlÄ± Cevaplar</h3><div class="h-48 w-full"><canvas id="quizChart"></canvas></div></div>
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><h3 class="text-sm font-bold text-yellow-400 uppercase mb-4">Yoklama</h3><div class="overflow-x-auto"><table class="w-full text-xs text-left text-slate-400"><thead class="uppercase bg-slate-700 text-slate-200"><tr><th class="px-2 py-2">No</th><th class="px-2 py-2">Ä°sim</th><th class="px-2 py-2">Puan</th><th class="px-2 py-2 text-right">+/-</th></tr></thead><tbody id="teacher-attendance-list" class="divide-y divide-slate-700"></tbody></table></div></div>
            </div>
            <div id="panel-judge" class="hidden space-y-6">
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><h3 class="text-sm font-bold text-slate-400 mb-3">AkÄ±ÅŸ KontrolÃ¼</h3><div class="grid grid-cols-2 gap-2 mb-4"><button onclick="setSpeaker('DavacÄ± AvukatÄ±')" class="p-2 bg-blue-900/50 border border-blue-700 rounded text-blue-100 text-xs">DavacÄ± Av.</button><button onclick="setSpeaker('SanÄ±k AvukatÄ±')" class="p-2 bg-red-900/50 border border-red-700 rounded text-red-100 text-xs">SanÄ±k Av.</button><button onclick="setSpeaker('SanÄ±k')" class="p-2 bg-red-900 border border-red-600 rounded text-white text-xs font-bold">SANIK</button><button onclick="setSpeaker('Hakim')" class="p-2 bg-yellow-600 rounded text-white text-xs font-bold">HAKÄ°M</button></div><div class="flex gap-2 border-t border-slate-600 pt-3"><button onclick="toggleVoteVisibility()" class="flex-1 bg-slate-700 p-2 rounded text-xs">Oylama Gizle/AÃ§</button><button onclick="resetSimulation()" class="flex-1 bg-red-900 p-2 rounded text-xs border border-red-700">âš ï¸ SIFIRLA</button></div></div>
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 h-64 flex flex-col"><div class="flex justify-between items-center mb-2"><h3 class="text-sm font-bold text-slate-400">SÃ¶z HakkÄ± (<span id="req-count">0</span>)</h3></div><div id="admin-speak-list" class="flex-1 overflow-y-auto space-y-2"></div></div>
            </div>
        </div>
    </div>

    <!-- 4. AKILLI TAHTA MODU -->
    <div id="projector-panel" class="hidden absolute inset-0 bg-slate-900 text-white z-[150] overflow-hidden flex flex-col p-6 relative">
        <!-- Delil YansÄ±tma KatmanÄ± -->
        <div id="evidence-overlay" class="hidden absolute inset-0 z-[300] bg-black flex items-center justify-center">
            <button onclick="closeEvidenceOverlay()" class="absolute top-4 right-4 text-white bg-red-600 px-4 py-2 rounded font-bold z-[310]">KAPAT</button>
            <div id="evidence-content" class="w-full h-full flex items-center justify-center p-4"></div>
        </div>

        <div id="notification-area" class="absolute top-24 right-6 w-96 z-[200] space-y-3 pointer-events-none"></div>
        <header class="flex justify-between items-center border-b border-slate-700 pb-4 mb-6">
            <div class="flex items-center gap-6"><div id="current-speaker-box" class="bg-slate-800 px-6 py-3 rounded-xl border-l-4 border-yellow-400 shadow-lg"><span class="text-[10px] text-slate-400 uppercase tracking-widest block mb-1">KÃœRSÃœDEKÄ° KONUÅMACI</span><h2 id="current-speaker-name" class="text-2xl font-bold text-white flex items-center gap-3"><i class="fa-solid fa-microphone-lines text-yellow-400 animate-pulse"></i><span id="speaker-text">Hakim</span></h2></div></div>
            <div class="text-right"><h1 class="text-3xl font-bold text-yellow-400 tracking-wider drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]">ADALET SÄ°M.</h1><div class="text-xs text-slate-400 mt-1">JÃ¼ri: <span id="proj-jury-count" class="font-bold text-white">0/35</span></div></div>
        </header>
        <div class="flex-1 grid grid-cols-12 gap-6">
            <div class="col-span-7 flex flex-col gap-4">
                <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl h-full flex flex-col justify-center items-center">
                    <h2 class="text-lg font-bold text-slate-400 uppercase mb-8">Vicdani Kanaat</h2>
                    <div class="relative w-full h-12 bg-slate-700 rounded-full mb-4 overflow-hidden"><div class="absolute inset-0 bg-gradient-to-r from-red-600 via-slate-600 to-green-600 opacity-50"></div><div id="proj-sentiment-marker" class="absolute top-0 w-2 h-full bg-white shadow-lg transition-all duration-700" style="left: 50%;"></div></div>
                    <div class="flex justify-between w-full font-bold px-2 mt-2"><span class="text-red-500">DAVACI</span><span class="text-green-500">SANIK</span></div>
                </div>
            </div>
            <div class="col-span-5 flex flex-col gap-4">
                <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl relative overflow-hidden h-1/2">
                    <h2 class="text-sm font-bold text-slate-400 uppercase mb-4 text-center">Oylama Durumu</h2>
                    <div id="vote-blind-overlay" class="absolute inset-0 z-10 bg-slate-800/95 flex flex-col items-center justify-center hidden"><i class="fa-solid fa-eye-slash text-4xl text-slate-600 mb-2"></i><h3 class="text-lg font-bold text-white">GÄ°ZLÄ°</h3></div>
                    <div id="vote-content" class="space-y-4 transition-all">
                        <div><div class="flex justify-between mb-1"><span class="text-sm font-bold text-red-500">SUÃ‡LU</span><span id="proj-vote-guilty" class="text-white font-bold text-sm">0</span></div><div class="h-6 bg-slate-700 rounded-full overflow-hidden border border-slate-600"><div id="proj-bar-guilty" class="h-full bg-red-600 transition-all duration-1000 shadow-[0_0_10px_red]" style="width: 0%"></div></div></div>
                        <div><div class="flex justify-between mb-1"><span class="text-sm font-bold text-green-500">SUÃ‡SUZ</span><span id="proj-vote-notguilty" class="text-white font-bold text-sm">0</span></div><div class="h-6 bg-slate-700 rounded-full overflow-hidden border border-slate-600"><div id="proj-bar-notguilty" class="h-full bg-green-600 transition-all duration-1000 shadow-[0_0_10px_green]" style="width: 0%"></div></div></div>
                    </div>
                    <div id="proj-final-verdict" class="mt-4 text-center text-2xl font-black tracking-widest hidden animate-pulse">KARAR: BEKLENÄ°YOR</div>
                </div>
                <div class="bg-slate-800 rounded-2xl border border-slate-700 h-1/2 flex flex-col overflow-hidden relative"><div class="bg-slate-700/50 p-2 border-b border-slate-600 flex justify-between items-center"><h2 class="text-xs font-bold text-yellow-400 uppercase pl-2">ğŸ’¬ MÃ¼zakere</h2></div><div id="proj-chat-feed" class="flex-1 p-4 space-y-3 overflow-y-auto flex flex-col-reverse"></div></div>
                <div class="bg-slate-800 rounded-2xl p-4 border border-slate-700 h-1/3 flex flex-col"><div class="flex justify-between items-center mb-2"><h3 class="text-xs font-bold text-slate-400 uppercase">YOKLAMA</h3><button onclick="location.reload()" class="text-[10px] text-slate-500"><i class="fa-solid fa-rotate"></i></button></div><div class="flex-1 overflow-y-auto no-scrollbar pr-1"><div id="proj-seat-grid" class="grid grid-cols-7 gap-1.5 content-start"></div></div></div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="admin-login-modal" class="hidden fixed inset-0 z-[200] bg-black/90 flex items-center justify-center p-4"><form onsubmit="handleAdminLogin(event)" class="bg-slate-800 p-6 rounded-xl w-full max-w-sm border border-slate-700 relative"><h3 class="text-xl font-bold text-white mb-4" id="login-role-title">GiriÅŸ Yap</h3><input type="password" id="admin-pass" placeholder="Åifre" class="w-full p-3 bg-slate-900 border border-slate-600 rounded mb-4 text-white outline-none focus:border-blue-500"><div class="flex gap-2"><button type="button" onclick="document.getElementById('admin-login-modal').classList.add('hidden')" class="w-1/2 bg-slate-700 text-white py-2 rounded font-bold">Ä°ptal</button><button type="submit" class="w-1/2 bg-blue-600 text-white font-bold py-2 rounded">GiriÅŸ</button></div></form></div>
    <!-- Image Modal -->
    <div id="image-modal" class="hidden fixed inset-0 z-[300] bg-black/95 flex items-center justify-center p-4" onclick="this.classList.add('hidden')"><img id="modal-img" src="" class="max-h-full max-w-full rounded"></div>
    <!-- KÄ±lavuz -->
    <div id="help-modal" class="hidden fixed inset-0 z-[300] bg-black/90 flex items-center justify-center p-4"><div class="bg-slate-800 w-full max-w-lg rounded-2xl border border-purple-500/50 shadow-[0_0_30px_rgba(168,85,247,0.2)] p-6"><h2 class="text-xl font-bold text-purple-400 mb-4 flex items-center gap-2"><i class="fa-solid fa-book"></i> Kullanma KÄ±lavuzu</h2><ul class="space-y-3 text-sm text-slate-300"><li>ğŸ‘©â€ğŸ“ <strong>Ã–ÄŸrenci:</strong> Koltuk seÃ§, kanÄ±tlarÄ± incele, tartÄ±ÅŸ.</li><li>ğŸ‘¨â€ğŸ« <strong>Ã–ÄŸretmen (admin):</strong> Quiz yap, "YansÄ±t" ile delil gÃ¶ster.</li><li>âš–ï¸ <strong>Hakim (1234):</strong> DuruÅŸmayÄ± yÃ¶net.</li></ul><button onclick="document.getElementById('help-modal').classList.add('hidden')" class="mt-6 w-full bg-purple-600 hover:bg-purple-500 text-white py-2 rounded font-bold">Tamam</button></div></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyB4afTGFkOqUjeVfqfHxgKCTbGHvftZIO4", authDomain: "mahkeme-sim.firebaseapp.com", projectId: "mahkeme-sim", storageBucket: "mahkeme-sim.firebasestorage.app", messagingSenderId: "573778878408", appId: "1:573778878408:web:67ab4ac006df3325ec6afd" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const SEATS='sim_seats', VOTES='sim_votes', CHAT='sim_chat', SPEAK_REQ='sim_speak_requests', QUIZZES='sim_quizzes', SCORES='sim_scores', SETTINGS='sim_settings', NOTIFICATIONS='sim_notifications';
        let currentUser=null, loginRole='', quizChart=null, initialLoadComplete=false;
        const neonColors = ['neon-pink', 'neon-cyan', 'neon-lime', 'neon-amber'];
        function getNeonColor(name) { return neonColors[name.length % neonColors.length]; }

        document.addEventListener('DOMContentLoaded', () => {
            initSettings(); generateSeats('koltuk-grid', true); checkSession();
            if(document.getElementById('quizChart')) {
                const ctx = document.getElementById('quizChart').getContext('2d');
                quizChart = new Chart(ctx, { type: 'bar', data: { labels: ['A', 'B', 'C', 'D'], datasets: [{ label: 'Cevaplar', data: [0,0,0,0], backgroundColor: ['#ef4444', '#3b82f6', '#eab308', '#22c55e'] }] }, options: { scales: { y: { beginAtZero: true, ticks: { color: 'white' } }, x: { ticks: { color: 'white' } } }, plugins: { legend: { display: false } }, responsive: true, maintainAspectRatio: false } });
            }
        });

        async function initSettings() {
            const flow = await db.collection(SETTINGS).doc('flow').get();
            if(!flow.exists) db.collection(SETTINGS).doc('flow').set({current_speaker: 'Hakim', show_votes: true, active_evidence: null});
        }

        // --- GÄ°RÄ°Å & KOLTUK ---
        function generateSeats(elId, clickable) {
            const grid = document.getElementById(elId); if(!grid) return; grid.innerHTML = '';
            db.collection(SEATS).onSnapshot(snap => {
                const occupied = {}; snap.forEach(doc => occupied[doc.id] = doc.data().name);
                grid.innerHTML = '';
                for(let i=1; i<=35; i++) {
                    const div = document.createElement('div');
                    const isTaken = occupied[i];
                    if(clickable) {
                        const btn = document.createElement('button');
                        btn.className = `w-full aspect-square rounded-lg font-bold text-xs flex items-center justify-center border border-slate-700 transition ${isTaken ? 'bg-slate-800 text-slate-600 cursor-not-allowed' : 'bg-slate-700 hover:bg-yellow-500 hover:text-slate-900 text-slate-300'}`;
                        btn.textContent = i; if(!isTaken) btn.onclick = () => selectSeat(i); grid.appendChild(btn);
                    } else {
                        div.className = `w-full aspect-square rounded border flex items-center justify-center p-0.5 text-center relative overflow-hidden ${isTaken ? 'bg-green-600 border-green-400 shadow' : 'bg-slate-800 border-slate-700 opacity-40'}`;
                        div.innerHTML = isTaken ? `<span class="text-[7px] font-bold text-white leading-none break-words line-clamp-2">${occupied[i]}</span>` : `<span class="text-slate-600 text-[9px] font-mono">${i}</span>`;
                        grid.appendChild(div);
                    }
                }
                const countEl = document.getElementById('proj-jury-count');
                if(countEl) countEl.textContent = `${Object.keys(occupied).length}/35`;
            });
        }

        async function selectSeat(id) {
            const name = document.getElementById('juri-ad').value.trim();
            if(name.length < 3) return alert("LÃ¼tfen adÄ±nÄ±zÄ± giriniz.");
            await db.collection(SEATS).doc(String(id)).set({name, seatId: id, timestamp: firebase.firestore.FieldValue.serverTimestamp()});
            await db.collection(SCORES).doc(String(id)).set({val: 0});
            localStorage.setItem('seatId', id); localStorage.setItem('name', name);
            enterApp(name, id);
        }

        function checkSession() { const s = localStorage.getItem('seatId'); const n = localStorage.getItem('name'); if(s && n) enterApp(n, s); }

        function enterApp(name, id) {
            currentUser = { name, seatId: id };
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-interface').classList.remove('hidden');
            document.getElementById('app-interface').classList.add('flex');
            document.getElementById('header-user-name').textContent = `${name} (${id})`;
            switchTab('tab-live', document.querySelector('.nav-item')); 
            initStudentListeners();
        }

        window.switchTab = function(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active')); 
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none'); 
            document.getElementById(tabId).style.display = 'flex'; 
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if(btn) btn.classList.add('active');
        }

        // --- Ã–ÄRENCÄ° ---
        function initStudentListeners() {
            db.collection(SCORES).doc(String(currentUser.seatId)).onSnapshot(doc => { if(doc.exists) document.getElementById('my-score').textContent = doc.data().val; });
            db.collection(QUIZZES).where('active', '==', true).onSnapshot(snap => {
                const modal = document.getElementById('student-quiz-modal');
                if(!snap.empty) {
                    const data = snap.docs[0].data();
                    document.getElementById('quiz-sound').play().catch(()=>{});
                    document.getElementById('quiz-question-text').textContent = data.question;
                    const opts = document.getElementById('quiz-options-container'); opts.innerHTML = '';
                    data.options.forEach((opt, idx) => {
                        const btn = document.createElement('button');
                        btn.className = "w-full p-4 bg-slate-800 hover:bg-yellow-500 hover:text-slate-900 rounded-xl border border-slate-600 text-left font-bold text-lg transition";
                        btn.textContent = opt; btn.onclick = () => submitAnswer(snap.docs[0].id, idx); opts.appendChild(btn);
                    });
                    modal.classList.remove('hidden');
                } else {
                    modal.classList.add('hidden'); document.getElementById('quiz-status-text').classList.add('hidden'); document.getElementById('quiz-options-container').classList.remove('hidden');
                }
            });
            document.getElementById('sentiment-slider').addEventListener('input', (e) => { setTimeout(() => db.collection('sim_sentiment').doc(String(currentUser.seatId)).set({val: parseInt(e.target.value), name: currentUser.name}), 300); });
        }

        async function submitAnswer(quizId, optionIdx) {
            await db.collection('sim_answers').add({ quizId, optionIdx, seatId: currentUser.seatId, name: currentUser.name, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            const quizDoc = await db.collection(QUIZZES).doc(quizId).get();
            if(String(optionIdx) === String(quizDoc.data().correctOption)) {
                db.collection(SCORES).doc(String(currentUser.seatId)).update({ val: firebase.firestore.FieldValue.increment(10) });
                alert("DOÄRU! +10 PUAN");
            } else { alert("YanlÄ±ÅŸ Cevap."); }
            document.getElementById('quiz-options-container').classList.add('hidden'); document.getElementById('quiz-status-text').classList.remove('hidden');
        }

        window.requestSpeech = function() { if(!currentUser) return; if(confirm("SÃ¶z hakkÄ± iste?")) db.collection(SPEAK_REQ).add({author: currentUser.name, seatId: currentUser.seatId, timestamp: firebase.firestore.FieldValue.serverTimestamp()}); }
        window.sendChat = function() { const txt = document.getElementById('chat-input').value; if(txt) { db.collection(CHAT).add({text:txt, author:currentUser.name, seatId:currentUser.seatId, timestamp: firebase.firestore.FieldValue.serverTimestamp()}); document.getElementById('chat-input').value=''; } }
        window.submitVote = function(vote) { if(confirm("KararÄ±nÄ±z kesin mi?")) { db.collection(VOTES).doc(String(currentUser.seatId)).set({vote}); document.getElementById('vote-status').textContent = "Oyunuz: " + vote; } }

        // --- YÃ–NETÄ°CÄ° ---
        window.openAdminLogin = function(role) {
            loginRole = role;
            document.getElementById('login-role-title').textContent = role === 'teacher' ? 'Ã–ÄŸretmen GiriÅŸi' : 'Hakim GiriÅŸi';
            document.getElementById('admin-login-modal').classList.remove('hidden');
        }

        window.handleAdminLogin = function(e) {
            e.preventDefault(); const pass = document.getElementById('admin-pass').value;
            let isValid = false;
            if (loginRole === 'teacher' && pass === 'admin') isValid = true;
            if (loginRole === 'judge' && pass === '1234') isValid = true;
            if(isValid) {
                document.getElementById('admin-login-modal').classList.add('hidden');
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('admin-title').textContent = loginRole === 'teacher' ? 'Ã–ÄRETMEN PANELÄ°' : 'HAKÄ°M PANELÄ°';
                if (loginRole === 'judge') { document.getElementById('btn-tab-teacher').classList.add('hidden'); document.getElementById('btn-tab-judge').classList.remove('hidden'); switchAdminTab('panel-judge'); initJudgePanel(); }
                else { document.getElementById('btn-tab-teacher').classList.remove('hidden'); document.getElementById('btn-tab-judge').classList.remove('hidden'); switchAdminTab('panel-teacher'); initTeacherPanel(); initJudgePanel(); }
            } else { alert("HatalÄ± Åifre!"); }
        }

        window.switchAdminTab = function(panelId) {
            document.getElementById('panel-teacher').classList.add('hidden'); document.getElementById('panel-judge').classList.add('hidden'); document.getElementById(panelId).classList.remove('hidden');
            document.querySelectorAll('.admin-tab-btn').forEach(btn => btn.classList.remove('text-yellow-400', 'border-yellow-400'));
            if(panelId === 'panel-teacher') document.getElementById('btn-tab-teacher').classList.add('text-yellow-400', 'border-yellow-400');
            else document.getElementById('btn-tab-judge').classList.add('text-yellow-400', 'border-yellow-400');
        }

        function initTeacherPanel() {
            db.collection(SEATS).onSnapshot(async (snap) => {
                const list = document.getElementById('teacher-attendance-list'); list.innerHTML = '';
                const scoreSnap = await db.collection(SCORES).get(); const scores = {}; scoreSnap.forEach(d => scores[d.id] = d.data().val);
                snap.forEach(doc => { const d = doc.data(); list.innerHTML += `<tr class="bg-slate-800 border-b border-slate-700"><td class="px-2 py-2">${d.seatId}</td><td class="px-2 py-2 font-bold text-white">${d.name}</td><td class="px-2 py-2 text-center text-yellow-400 font-mono">${scores[d.seatId] || 0}</td><td class="px-2 py-2 text-right"><button onclick="modScore('${d.seatId}', 5)" class="text-green-500 mr-2"><i class="fa-solid fa-plus"></i></button><button onclick="modScore('${d.seatId}', -5)" class="text-red-500"><i class="fa-solid fa-minus"></i></button></td></tr>`; });
            });
            db.collection(QUIZZES).where('active', '==', true).onSnapshot(snap => {
                if(!snap.empty && quizChart) {
                    db.collection('sim_answers').where('quizId', '==', snap.docs[0].id).onSnapshot(ansSnap => {
                        const counts = [0, 0, 0, 0]; ansSnap.forEach(d => { if(d.data().optionIdx >= 0) counts[d.data().optionIdx]++; });
                        quizChart.data.datasets[0].data = counts; quizChart.update();
                    });
                }
            });
        }
        window.modScore = function(seatId, amount) { db.collection(SCORES).doc(String(seatId)).update({ val: firebase.firestore.FieldValue.increment(amount) }); }
        window.publishQuiz = function() {
            const q = document.getElementById('quiz-q').value;
            const opts = [1,2,3,4].map(i => document.getElementById('quiz-opt'+i).value);
            const correct = document.getElementById('quiz-correct').value;
            if(!q || opts.some(x=>!x)) return alert("Eksik bilgi");
            db.collection(QUIZZES).where('active', '==', true).get().then(snap => { snap.forEach(d => d.ref.update({active: false})); }).then(() => {
                db.collection(QUIZZES).add({ question: q, options: opts, correctOption: correct, active: true, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                alert("Quiz YayÄ±nda!");
            });
        }
        window.closeQuiz = function() { db.collection(QUIZZES).where('active', '==', true).get().then(s => s.forEach(d => d.ref.update({active: false}))); alert("KapatÄ±ldÄ±"); }

        function initJudgePanel() {
            db.collection(SPEAK_REQ).orderBy('timestamp', 'asc').onSnapshot(snap => {
                const list = document.getElementById('admin-speak-list');
                document.getElementById('req-count').textContent = snap.size; list.innerHTML = '';
                snap.forEach(doc => { const d = doc.data(); list.innerHTML += `<div class="bg-slate-700 p-2 rounded flex justify-between items-center mb-2"><span class="text-sm">${d.author}</span><button onclick="approveSpeech('${doc.id}', '${d.author}')" class="bg-green-600 px-2 rounded text-xs">SÃ¶z Ver</button></div>`; });
            });
        }
        window.approveSpeech = function(id, name) {
            db.collection(NOTIFICATIONS).add({ text: `${name} konuÅŸabilir.`, type: 'grant', timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            db.collection(SPEAK_REQ).doc(id).delete(); window.setSpeaker(name);
        }
        window.setSpeaker = function(name) { db.collection(SETTINGS).doc('flow').update({ current_speaker: name }); }
        window.toggleVoteVisibility = function() { db.collection(SETTINGS).doc('flow').get().then(d => db.collection(SETTINGS).doc('flow').update({ show_votes: !d.data().show_votes })); }
        
        // --- DELÄ°L YANSITMA (YENÄ°) ---
        window.projectEvidence = function(src) {
            db.collection(SETTINGS).doc('flow').update({ active_evidence: src });
            alert(src ? "Tahtaya yansÄ±tÄ±ldÄ±." : "YansÄ±tma durduruldu.");
        }
        window.closeEvidenceOverlay = function() {
            document.getElementById('evidence-overlay').classList.add('hidden');
            document.getElementById('evidence-content').innerHTML = '';
        }

        // --- PROJECTOR ---
        window.openProjectorMode = function() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('projector-panel').classList.remove('hidden');
            initProjectorData();
        }
        function initProjectorData() {
            generateSeats('proj-seat-grid', false);
            // AkÄ±ÅŸ & Delil Dinleyici
            db.collection(SETTINGS).doc('flow').onSnapshot(doc => {
                if(doc.exists) {
                    const d = doc.data();
                    const el = document.getElementById('speaker-text');
                    if(el.textContent !== d.current_speaker) { el.textContent = d.current_speaker; document.getElementById('current-speaker-box').classList.add('speaker-change'); setTimeout(()=>document.getElementById('current-speaker-box').classList.remove('speaker-change'),1000); }
                    
                    const overlay = document.getElementById('vote-blind-overlay'), content = document.getElementById('vote-content');
                    if(d.show_votes) { overlay.classList.add('hidden'); content.classList.remove('blur-overlay'); } else { overlay.classList.remove('hidden'); content.classList.add('blur-overlay'); }

                    // Delil YansÄ±tma KontrolÃ¼
                    const evOverlay = document.getElementById('evidence-overlay');
                    const evContent = document.getElementById('evidence-content');
                    if(d.active_evidence) {
                        evOverlay.classList.remove('hidden');
                        if(d.active_evidence === 'video') {
                            evContent.innerHTML = '<video src="olay_yeri.mp4" controls autoplay class="max-h-full max-w-full shadow-2xl border-4 border-white"></video>';
                        } else {
                            evContent.innerHTML = `<img src="${d.active_evidence}" class="max-h-full max-w-full shadow-2xl border-4 border-white">`;
                        }
                    } else {
                        evOverlay.classList.add('hidden');
                        evContent.innerHTML = '';
                    }
                }
            });
            // Bildirim
            setTimeout(() => { initialLoadComplete = true; }, 2000);
            db.collection(NOTIFICATIONS).orderBy('timestamp', 'desc').limit(1).onSnapshot(snap => {
                if(!initialLoadComplete) return;
                snap.docChanges().forEach(change => { if(change.type === "added") { const d = change.doc.data(); if((new Date()-d.timestamp.toDate())<10000) { document.getElementById('alert-sound').play(); showNotification("SÃ–Z HAKKI", d.text); } } });
            });
            db.collection(CHAT).orderBy('timestamp','desc').limit(20).onSnapshot(s => {
                const f = document.getElementById('proj-chat-feed'); f.innerHTML='';
                s.forEach(d => {
                    const neonClass = getNeonColor(d.data().author);
                    f.innerHTML += `<div class="bg-slate-900/80 p-2 rounded mb-2 border-l-4 border-cyan-500 msg-enter"><b class="${neonClass} text-xs block mb-1 font-black tracking-wide">${d.data().author}</b><span class="text-white text-sm leading-tight">${d.data().text}</span></div>`;
                });
            });
            db.collection('sim_sentiment').onSnapshot(s=>{ let t=0, c=0; s.forEach(d=>{t+=d.data().val;c++}); if(c>0) document.getElementById('proj-sentiment-marker').style.left = (t/c)+"%"; });
            
            // Oylama
            db.collection(VOTES).onSnapshot(s => {
                let g=0, ng=0; s.forEach(d => d.data().vote === 'SUÃ‡LU' ? g++ : ng++);
                document.getElementById('proj-vote-guilty').textContent = g;
                document.getElementById('proj-vote-notguilty').textContent = ng;
                const t = g + ng;
                if(t > 0) {
                    document.getElementById('proj-bar-guilty').style.width = (g/t*100) + "%";
                    document.getElementById('proj-bar-notguilty').style.width = (ng/t*100) + "%";
                }
                const v = document.getElementById('proj-final-verdict');
                if(g >= 18) { v.innerHTML="KARAR: <span class='text-red-500'>SUÃ‡LU</span>"; v.classList.remove('hidden'); confetti({particleCount: 100, spread: 70, origin: { y: 0.6 }}); }
                else if(ng >= 18) { v.innerHTML="KARAR: <span class='text-green-500'>SUÃ‡SUZ</span>"; v.classList.remove('hidden'); confetti({particleCount: 100, spread: 70, origin: { y: 0.6 }}); }
                else { v.classList.add('hidden'); }
            });
        }

        function showNotification(t,m) {
            const c=document.getElementById('notification-area'), n=document.createElement('div');
            n.className="bg-yellow-500 text-slate-900 px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4 border-4 border-white/20 msg-enter";
            n.innerHTML=`<div class="bg-white w-10 h-10 rounded-full flex items-center justify-center font-bold"><i class="fa-solid fa-gavel"></i></div><div><h4 class="font-black text-lg uppercase">${t}</h4><p class="text-sm font-semibold">${m}</p></div>`;
            c.appendChild(n); setTimeout(()=>n.remove(),5000);
        }

        window.resetSimulation = async function() {
            if(!confirm("TÃœM VERÄ°LER SÄ°LÄ°NECEK. ONAYLIYOR MUSUNUZ?")) return;
            const cols = [SEATS, VOTES, QUIZZES, SCORES, CHAT, SPEAK_REQ, NOTIFICATIONS, 'sim_answers', 'sim_sentiment'];
            try {
                for (const col of cols) { const snap = await db.collection(col).get(); if (!snap.empty) { const batch = db.batch(); snap.docs.forEach(doc => batch.delete(doc.ref)); await batch.commit(); } }
                await db.collection(SETTINGS).doc('flow').set({current_speaker: 'Hakim', show_votes: true});
                alert("Sistem SÄ±fÄ±rlandÄ±."); location.reload();
            } catch (error) { console.error(error); alert("Hata oluÅŸtu: " + error.message); }
        }

        window.openImage = function(src) { document.getElementById('modal-img').src=src; document.getElementById('image-modal').classList.remove('hidden'); }
        window.logoutUser = function() { localStorage.clear(); location.reload(); }
        window.sendQuestion = function() {
            const txt = document.getElementById('question-input').value.trim();
            if(!txt) return;
            db.collection(QUESTIONS).add({text: txt, author: currentUser.name, seat: currentUser.seatId, timestamp: firebase.firestore.FieldValue.serverTimestamp()});
            alert("Soru gÃ¶nderildi."); document.getElementById('question-input').value = '';
        }
    </script>
</body>
</html>


