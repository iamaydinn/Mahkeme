<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem YÃ¶neticisi | Adalet Sim.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { background-color: #0b0c15; color: #cbd5e1; font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Sol MenÃ¼ Aktiflik */
        .sidebar-link { display: flex; items-center; gap: 10px; padding: 12px; border-radius: 8px; color: #94a3b8; transition: all 0.2s; cursor: pointer; }
        .sidebar-link:hover { background: #1e293b; color: #fff; }
        .sidebar-link.active { background: linear-gradient(90deg, #0ea5e9 0%, #0284c7 100%); color: white; box-shadow: 0 0 15px rgba(14, 165, 233, 0.3); }
        
        /* Kartlar */
        .card { background: #151725; border: 1px solid #2a2d3d; border-radius: 12px; padding: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #2a2d3d; }
        .card-title { font-size: 0.85rem; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }

        /* Inputs */
        input, select, textarea { background: #0f111a; border: 1px solid #334155; color: white; border-radius: 6px; padding: 8px 12px; font-size: 0.9rem; width: 100%; outline: none; transition: border 0.2s; }
        input:focus, select:focus, textarea:focus { border-color: #38bdf8; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>

    <!-- GÄ°RÄ°Å EKRANI (OVERLAY) -->
    <div id="login-overlay" class="fixed inset-0 z-[100] bg-[#0b0c15] flex items-center justify-center">
        <div class="w-full max-w-sm p-8 card text-center border-t-4 border-blue-600">
            <i class="fa-solid fa-fingerprint text-5xl text-blue-500 mb-4"></i>
            <h2 class="text-xl font-bold text-white mb-6">SÄ°STEM YÃ–NETÄ°CÄ°SÄ°</h2>
            <form onsubmit="adminLogin(event)" class="space-y-4">
                <input type="text" id="adm-user" placeholder="KullanÄ±cÄ± AdÄ±" class="text-center">
                <input type="password" id="adm-pass" placeholder="Parola" class="text-center">
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded transition shadow-lg shadow-blue-900/20">GÄ°RÄ°Å YAP</button>
            </form>
            <p id="login-error" class="text-red-500 text-xs mt-4 h-4"></p>
        </div>
    </div>

    <!-- SIDEBAR -->
    <aside class="w-64 bg-[#0f111a] border-r border-[#2a2d3d] flex flex-col z-10">
        <div class="p-6 border-b border-[#2a2d3d]">
            <h1 class="text-xl font-black text-white tracking-wider flex items-center gap-2">
                <i class="fa-solid fa-shield-cat text-blue-500"></i> ADMIN<span class="text-blue-500">PANEL</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1 mono">v41.0-stable</p>
        </div>
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <!-- ID'ler JS'deki switchPage fonksiyonuyla eÅŸleÅŸmeli -->
            <div class="sidebar-link active" onclick="switchPage('dashboard', this)"><i class="fa-solid fa-gauge-high"></i> GÃ¶sterge Paneli</div>
            <div class="sidebar-link" onclick="switchPage('users', this)"><i class="fa-solid fa-users-gear"></i> KullanÄ±cÄ± YÃ¶netimi</div>
            <div class="sidebar-link" onclick="switchPage('content', this)"><i class="fa-solid fa-folder-plus"></i> Dosya & Ä°Ã§erik</div>
            <div class="sidebar-link text-red-400 hover:text-red-300" onclick="switchPage('danger', this)"><i class="fa-solid fa-triangle-exclamation"></i> Acil Durum</div>
        </nav>
        <div class="p-4 border-t border-[#2a2d3d]">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-blue-900/50 flex items-center justify-center text-blue-400 font-bold border border-blue-800">M</div>
                <div>
                    <p class="text-xs font-bold text-white">Muhammet E.</p>
                    <p class="text-[10px] text-green-500">â— YÃ¶netici</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 bg-[#0b0c15] flex flex-col min-w-0 relative">
        
        <!-- Header -->
        <header class="h-16 border-b border-[#2a2d3d] flex justify-between items-center px-8 bg-[#0f111a]">
            <h2 class="text-white font-bold" id="page-title">GÃ¶sterge Paneli</h2>
            <button onclick="location.reload()" class="text-xs bg-slate-800 hover:bg-slate-700 text-white px-3 py-2 rounded border border-slate-600">Ã‡IKIÅ YAP</button>
        </header>

        <div class="flex-1 overflow-y-auto p-8">

            <!-- 1. DASHBOARD SAYFASI -->
            <div id="page-dashboard" class="page-section">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="card border-l-4 border-green-500">
                        <div class="text-slate-400 text-xs font-bold uppercase mb-1">Aktif JÃ¼ri</div>
                        <div class="text-3xl font-bold text-white" id="stat-seats">0</div>
                    </div>
                    <div class="card border-l-4 border-blue-500">
                        <div class="text-slate-400 text-xs font-bold uppercase mb-1">Toplam Oy</div>
                        <div class="text-3xl font-bold text-white" id="stat-votes">0</div>
                    </div>
                    <div class="card border-l-4 border-yellow-500">
                        <div class="text-slate-400 text-xs font-bold uppercase mb-1">Sistem Durumu</div>
                        <div class="text-xl font-bold text-white" id="stat-status">NORMAL</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header"><span class="card-title">ğŸ“¢ SÄ°STEM DUYURUSU (CHAT)</span></div>
                    <div class="flex gap-3">
                        <input type="text" id="broadcast-text" placeholder="TÃ¼m Ã¶ÄŸrencilere gidecek mesaj...">
                        <button onclick="sendBroadcast()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 rounded font-bold text-sm">GÃ–NDER</button>
                    </div>
                </div>
            </div>

            <!-- 2. KULLANICI YÃ–NETÄ°MÄ° -->
            <div id="page-users" class="page-section hidden">
                <div class="card p-0 overflow-hidden">
                    <div class="p-4 border-b border-[#2a2d3d] bg-[#1a1d2d]"><h3 class="font-bold text-white">KatÄ±lÄ±mcÄ± Listesi</h3></div>
                    <table class="w-full text-left text-sm text-slate-400">
                        <thead class="bg-[#1a1d2d] text-slate-200 text-xs uppercase">
                            <tr><th class="p-4">Koltuk</th><th class="p-4">Ä°sim</th><th class="p-4">Puan</th><th class="p-4 text-right">Ä°ÅŸlem</th></tr>
                        </thead>
                        <tbody id="admin-user-list" class="divide-y divide-slate-800">
                            <!-- JS ile dolacak -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 3. Ä°Ã‡ERÄ°K YÃ–NETÄ°MÄ° -->
            <div id="page-content" class="page-section hidden space-y-6">
                <div class="card">
                    <div class="card-header"><span class="card-title">YENÄ° DELÄ°L YÃœKLE</span></div>
                    <div class="space-y-3">
                        <input type="text" id="ev-title" placeholder="Delil AdÄ± (Ã–rn: Olay Yeri 2)">
                        <input type="text" id="ev-url" placeholder="Resim veya Video URL'si">
                        <select id="ev-type">
                            <option value="image">GÃ¶rsel (Resim)</option>
                            <option value="video">Video</option>
                        </select>
                        <button onclick="addEvidence()" class="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded font-bold text-sm">SÄ°STEME EKLE</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header"><span class="card-title">SENARYO BAÅLIKLARI</span></div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="set-uni" placeholder="Kurum AdÄ±">
                        <input type="text" id="set-dept" placeholder="BÃ¶lÃ¼m AdÄ±">
                    </div>
                    <button onclick="updateTitles()" class="mt-3 bg-slate-700 hover:bg-slate-600 text-white py-2 px-4 rounded text-xs font-bold">GÃœNCELLE</button>
                </div>
            </div>

            <!-- 4. ACÄ°L DURUM -->
            <div id="page-danger" class="page-section hidden space-y-6">
                <div class="card border-red-900/50 bg-red-950/10">
                    <div class="card-header"><span class="card-title text-red-500">SÄ°STEM KÄ°LÄ°DÄ° (BAKIM MODU)</span></div>
                    <p class="text-sm text-slate-400 mb-4">Bu Ã¶zellik aÃ§Ä±ldÄ±ÄŸÄ±nda Ã¶ÄŸrenciler "SÄ°STEM BAKIMDA" ekranÄ±nÄ± gÃ¶rÃ¼r ve iÅŸlem yapamaz.</p>
                    <button onclick="toggleMaintenance()" id="btn-maintenance" class="w-full bg-yellow-600 hover:bg-yellow-500 text-white py-3 rounded font-bold">KÄ°LÄ°TLE</button>
                </div>

                <div class="card border-red-900/50 bg-red-950/10">
                    <div class="card-header"><span class="card-title text-red-500">VERÄ°TABANI SIFIRLAMA</span></div>
                    <p class="text-sm text-slate-400 mb-4">TÃ¼m kullanÄ±cÄ±larÄ±, oylarÄ± ve mesajlarÄ± siler. Geri alÄ±namaz.</p>
                    <button onclick="wipeAllData()" class="w-full bg-red-700 hover:bg-red-600 text-white py-3 rounded font-bold">FABRÄ°KA AYARLARINA DÃ–N</button>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- FIREBASE ---
        const firebaseConfig = { apiKey: "AIzaSyB4afTGFkOqUjeVfqfHxgKCTbGHvftZIO4", authDomain: "mahkeme-sim.firebaseapp.com", projectId: "mahkeme-sim", storageBucket: "mahkeme-sim.firebasestorage.app", messagingSenderId: "573778878408", appId: "1:573778878408:web:67ab4ac006df3325ec6afd" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- SAYFA YÃ–NETÄ°MÄ° (TABLAR) ---
        window.switchPage = function(pageId, btn) {
            // TÃ¼m sayfalarÄ± gizle
            document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
            // Ä°stenen sayfayÄ± aÃ§
            const target = document.getElementById('page-' + pageId);
            if(target) target.classList.remove('hidden');

            // Buton stilini gÃ¼ncelle
            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
            if(btn) btn.classList.add('active');

            // BaÅŸlÄ±ÄŸÄ± gÃ¼ncelle
            const titles = { 'dashboard': 'GÃ¶sterge Paneli', 'users': 'KullanÄ±cÄ± YÃ¶netimi', 'content': 'Ä°Ã§erik YÃ¶netimi', 'danger': 'Acil Durum BÃ¶lgesi' };
            document.getElementById('page-title').innerText = titles[pageId] || 'Panel';
        }

        // --- GÄ°RÄ°Å ---
        function adminLogin(e) {
            e.preventDefault();
            const u = document.getElementById('adm-user').value;
            const p = document.getElementById('adm-pass').value;
            if(u === 'muhammet' && p === 'muhammet25') {
                document.getElementById('login-overlay').classList.add('hidden');
                initDataListeners();
            } else {
                document.getElementById('login-error').innerText = 'HatalÄ± kimlik bilgileri!';
            }
        }

        // --- VERÄ° DÄ°NLEYÄ°CÄ°LERÄ° ---
        function initDataListeners() {
            // Ä°statistikler & KullanÄ±cÄ± Listesi
            db.collection('sim_seats').orderBy('seatId').onSnapshot(async (snap) => {
                document.getElementById('stat-seats').innerText = snap.size;
                const list = document.getElementById('admin-user-list');
                list.innerHTML = '';
                
                const scoresSnap = await db.collection('sim_scores').get();
                const scores = {}; scoresSnap.forEach(d => scores[d.id] = d.data().val);

                snap.forEach(doc => {
                    const d = doc.data();
                    list.innerHTML += `
                    <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                        <td class="p-4 font-mono text-yellow-500">#${d.seatId}</td>
                        <td class="p-4 font-bold text-white">${d.name}</td>
                        <td class="p-4 text-blue-400 font-mono">${scores[d.seatId] || 0}</td>
                        <td class="p-4 text-right"><button onclick="kickUser('${d.seatId}')" class="text-red-500 hover:text-white border border-red-900 hover:bg-red-600 px-3 py-1 rounded text-xs transition">AT</button></td>
                    </tr>`;
                });
            });

            // Oy SayÄ±sÄ±
            db.collection('sim_votes').onSnapshot(s => document.getElementById('stat-votes').innerText = s.size);

            // BakÄ±m Modu Durumu
            db.collection('sim_settings').doc('flow').onSnapshot(doc => {
                if(doc.exists) {
                    const locked = doc.data().system_locked;
                    const btn = document.getElementById('btn-maintenance');
                    const stat = document.getElementById('stat-status');
                    if(locked) {
                        btn.innerText = "KÄ°LÄ°DÄ° AÃ‡ (SÄ°STEMÄ° AKTÄ°F ET)";
                        btn.className = "w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded font-bold";
                        stat.innerText = "BAKIMDA (KÄ°LÄ°TLÄ°)";
                        stat.classList.add('text-red-500');
                    } else {
                        btn.innerText = "SÄ°STEMÄ° KÄ°LÄ°TLE";
                        btn.className = "w-full bg-yellow-600 hover:bg-yellow-500 text-white py-3 rounded font-bold";
                        stat.innerText = "AKTÄ°F";
                        stat.classList.remove('text-red-500');
                    }
                }
            });
        }

        // --- FONKSÄ°YONLAR ---

        window.kickUser = function(seatId) {
            if(confirm(`KullanÄ±cÄ± #${seatId} atÄ±lsÄ±n mÄ±?`)) db.collection('sim_seats').doc(String(seatId)).delete();
        }

        window.sendBroadcast = function() {
            const t = document.getElementById('broadcast-text').value;
            if(!t) return;
            db.collection('sim_chat').add({ text: t, author: 'SÄ°STEM DUYURUSU', seatId: '00', role: 'admin', timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            alert("Duyuru gÃ¶nderildi.");
            document.getElementById('broadcast-text').value = '';
        }

        window.addEvidence = function() {
            const title = document.getElementById('ev-title').value;
            const url = document.getElementById('ev-url').value;
            const type = document.getElementById('ev-type').value;
            if(!title || !url) return alert("Eksik bilgi.");
            db.collection('sim_evidence').add({ title, url, type, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            alert("Delil eklendi!");
        }

        window.toggleMaintenance = function() {
            const ref = db.collection('sim_settings').doc('flow');
            ref.get().then(d => {
                ref.set({ system_locked: !d.data().system_locked }, { merge: true });
            });
        }
        
        window.updateTitles = function() {
            const uni = document.getElementById('set-uni').value;
            const dept = document.getElementById('set-dept').value;
            db.collection('sim_settings').doc('titles').set({ uni, dept }, { merge: true });
            alert("BaÅŸlÄ±klar gÃ¼ncellendi.");
        }

        window.wipeAllData = async function() {
            if(prompt("Onaylamak iÃ§in SÄ°L yazÄ±n") !== 'SÄ°L') return;
            const cols = ['sim_seats', 'sim_votes', 'sim_quizzes', 'sim_scores', 'sim_chat', 'sim_speak_requests', 'sim_notifications', 'sim_answers', 'sim_sentiment', 'sim_evidence'];
            for(const col of cols) {
                const snap = await db.collection(col).get();
                const batch = db.batch();
                snap.docs.forEach(d => batch.delete(d.ref));
                await batch.commit();
            }
            alert("Sistem temizlendi.");
        }
    </script>
</body>
</html>
